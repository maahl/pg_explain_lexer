\documentclass{article}

\usepackage[margin=0.5cm]{geometry}
\paperwidth=\dimexpr \paperwidth + 2cm\relax
\usepackage{minted}
\usemintedstyle{colorful}

\newenvironment{queryplan}[1]{
    \VerbatimEnvironment%
    \begin{listing}
        \caption{#1}
        \begin{minted}[frame=lines, framesep=2mm, fontsize=\footnotesize]{../pg_explain_lexer.py:PgExplainLexer -x}}{%
        \end{minted}
    \end{listing}
}

\begin{document}

\begin{queryplan}{merge join}
                                                                  QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------------------------
 Merge Join  (cost=0.62..1351.74 rows=8893 width=302) (actual time=0.130..45.729 rows=8897 loops=1)
   Merge Cond: (c.customerid = o.customerid)
   ->  Index Scan using customers_pkey on customers c  (cost=0.29..845.29 rows=20000 width=268) (actual time=0.032..10.950 rows=19997 loops=1)
   ->  Index Scan using ix_order_custid on orders o  (cost=0.29..345.29 rows=8893 width=30) (actual time=0.070..19.943 rows=8897 loops=1)
         Filter: (netamount > '100'::numeric)
         Rows Removed by Filter: 3103
 Planning Time: 3.843 ms
 Execution Time: 52.293 ms
\end{queryplan}

\begin{queryplan}{nested loop + sort}
                                                    QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=7224521.31..7224543.54 rows=8893 width=302) (actual time=111918.890..111919.623 rows=8897 loops=1)
   Sort Key: c.customerid
   Sort Method: quicksort  Memory: 2817kB
   ->  Nested Loop  (cost=0.00..7223938.00 rows=8893 width=302) (actual time=205.686..111816.823 rows=8897 loops=1)
         Join Filter: (c.customerid = o.customerid)
         Rows Removed by Join Filter: 177931103
         ->  Seq Scan on customers c  (cost=0.00..688.00 rows=20000 width=268) (actual time=8.168..31.380 rows=20000 loops=1)
         ->  Seq Scan on orders o  (cost=0.00..250.00 rows=8893 width=30) (actual time=0.006..4.604 rows=8897 loops=20000)
               Filter: (netamount > '100'::numeric)
               Rows Removed by Filter: 3103
 Planning Time: 0.777 ms
 Execution Time: 111925.339 ms
\end{queryplan}

\begin{queryplan}{hash join}
                                                            QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=1575.48..1590.32 rows=5934 width=304) (actual time=33.584..34.200 rows=5936 loops=1)
   Sort Key: o.netamount
   Sort Method: quicksort  Memory: 1816kB
   ->  Hash Join  (cost=938.00..1203.58 rows=5934 width=304) (actual time=12.335..23.709 rows=5936 loops=1)
         Hash Cond: (o.customerid = c.customerid)
         ->  Seq Scan on orders o  (cost=0.00..250.00 rows=5934 width=30) (actual time=0.034..5.769 rows=5936 loops=1)
               Filter: (netamount > '200'::numeric)
               Rows Removed by Filter: 6064
         ->  Hash  (cost=688.00..688.00 rows=20000 width=268) (actual time=12.254..12.254 rows=20000 loops=1)
               Buckets: 32768  Batches: 1  Memory Usage: 4108kB
               ->  Seq Scan on customers c  (cost=0.00..688.00 rows=20000 width=268) (actual time=0.012..5.910 rows=20000 loops=1)
 Planning Time: 1.154 ms
 Execution Time: 40.343 ms
\end{queryplan}

\begin{queryplan}{multiple conditions in filter}
                                                  QUERY PLAN
--------------------------------------------------------------------------------------------------------------
 Seq Scan on customers c  (cost=0.00..788.00 rows=769 width=268) (actual time=0.101..10.838 rows=776 loops=1)
   Filter: ((age < 20) OR (age = 22))
   Rows Removed by Filter: 19224
 Planning Time: 0.233 ms
 Execution Time: 11.107 ms
\end{queryplan}

\begin{queryplan}{limit}
                                                  QUERY PLAN
--------------------------------------------------------------------------------------------------------------
 Limit  (cost=0.00..0.18 rows=10 width=30) (actual time=0.033..0.041 rows=10 loops=1)
   ->  Seq Scan on orders  (cost=0.00..220.00 rows=12000 width=30) (actual time=0.030..0.034 rows=10 loops=1)
 Planning Time: 0.154 ms
 Execution Time: 0.414 ms
\end{queryplan}

\begin{queryplan}{hash right join}
                                                         QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------
 Hash Right Join  (cost=938.00..1189.51 rows=20000 width=298) (actual time=10.990..29.612 rows=23004 loops=1)
   Hash Cond: (o.customerid = c.customerid)
   ->  Seq Scan on orders o  (cost=0.00..220.00 rows=12000 width=30) (actual time=0.010..1.664 rows=12000 loops=1)
   ->  Hash  (cost=688.00..688.00 rows=20000 width=268) (actual time=10.940..10.940 rows=20000 loops=1)
         Buckets: 32768  Batches: 1  Memory Usage: 4108kB
         ->  Seq Scan on customers c  (cost=0.00..688.00 rows=20000 width=268) (actual time=0.016..4.918 rows=20000 loops=1)
 Planning Time: 0.707 ms
 Execution Time: 32.227 ms
\end{queryplan}

\end{document}
